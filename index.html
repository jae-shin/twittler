<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <title>Twittler</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <header class='container'>
      <h1>Welcome to Twittler!</h1>
    </header>

    <section class='container group'>
      <button name='home'>Home</button>
      <button name='newTweets'>See New Tweets</button>
      
      <br><br>
        
      <div class='writeTweet'>
        <h3>Write your own Tweet</h3>
        <p>Greetings visitor! Feel free to set a username and start tweeting!<p>
        <p> @:
          <input class="set" type = "text">
          <button name='set'>Set</button>
        </p>
        <div id="status1">Please set your username first (above)</div>
        <div id="status2"></div>
        <p> Message:
          <input class="tweet" type = "text">
          <button name='tweet'>Tweet!</button>
        </p>
      </div>

    </section>


    <section class='container'>
      <div class='feedTitle'>Here are the tweets from your friends...</div>
      <div class='userTitle'></div>
    </section>
    

    <section class='feed'>
    </section>




    <script>

      $(document).ready(function(){
        
        var index = 0;

        // Shows new tweets under Feed
        var refreshTweets = function(){
          var length = streams.home.length;
          while(index < length){
            var tweet = streams.home[index];
            var $tweet = $('<div></div>');
            $tweet.addClass('container tweets');
            $tweet.addClass(tweet.user);

            if(!tweet.created_at){
              tweet.created_at = new Date();
            }

            $tweet.html('<span>@' + tweet.user + '</span>' + ': ' + tweet.message + '   ' + tweet.created_at);

            $tweet.children('span').addClass('userName');

            $('.feed').prepend($tweet);
            index++;
          }
        }

        // Show the pre-generated 11 tweets
        refreshTweets(); 

        // wrap commands to return to the home page with full feed
        var returnHome = function() {
          $('.feed div').show();
          $('.feedTitle').show();
          $('.userTitle').hide();
        }

        // When the 'See New Tweets' button is clicked, show new tweets
        $('button[name=newTweets]').on('click', function() {
          returnHome();
          refreshTweets();
        });

        // When the 'Home' button is clicked, return to the home page
        $('button[name=home]').on('click', returnHome);

        // filter feed when user name is clicked
        $('.feed').on('click', '.userName', function() {
          var userString = $(this).text().slice(1);
          // var tweetsOfUser = streams.users[userString];
          $('.feedTitle').hide();
          $('.userTitle').show().text('Here is the Twittler timeline of @' + userString + "...");
          var userClass = '.' + userString;
          $('.feed div').hide();
          $('.feed').find(userClass).show();
        });

        // Implement writeTweet feature
        $('button[name=set]').on('click', function() {
          window.visitor = $('input.set').val();
          if (visitor) {
            $('#status1').hide();
            $('#status2').show().text('Your username is set to @' + visitor);
          } 
          $('input.set').val('');
        });
          
        $('button[name=tweet]').on('click', function() {
          var message = $('input.tweet').val();
          if (message && visitor) {
            streams.users[visitor] = [];
            writeTweet(message);
            refreshTweets();
          }
          $('input.tweet').val('');
        });
          
      });

    </script>

  </body>
</html>
